#!/bin/bash

#configurando o base dir
BASEDIR=${PWD}

mkdir ${BASEDIR}/fastq
mkdir ${BASEDIR}/depth
mkdir ${BASEDIR}/map
mkdir ${BASEDIR}/somia
mkdir ${BASEDIR}/janela

for LIB in SRR20748434;

do

#for LIB in SRR25338393 SRR25338394 SRR25338395 SRR25338396 SRR25338397 SRR23698496 SRR23698498 SRR23698499 ERR9715627 ERR9715626 ERR9715625 ERR9715624 SRR21711081 SRR21711086 SRR7970013 SRR7970014 SRR7970015 SRR7970016 SRR7970017 SRR7970018 SRR7970019 SRR7970021 SRR7970022 SRR7970023 SRR7970024 SRR7970025 SRR7970026 SRR7970027 SRR7970028 SRR7970029 SRR7970030 SRR7970031 SRR7970032 SRR7970033 SRR7970034 SRR7970035 SRR7970036 SRR7970037 SRR7970038 SRR21162039 SRR21162040 SRR21162041 SRR21162042 SRR21162043 SRR21162044 SRR21162045 SRR21162047 SRR21162048 SRR21162049 SRR16972310 SRR16972313 SRR16972315 SRR16972316 SRR16972317 SRR16972318 SRR16972319 SRR16972321 SRR16972322 SRR16972323 SRR16972324 SRR16972325 SRR16972326 SRR16972327 SRR16972328 SRR16972329 SRR16972330 SRR16972331 SRR16972332 SRR16972334 SRR16972335 SRR16972336 SRR16972337 SRR16972338 SRR16972339 SRR16972341 SRR16972342 SRR16972344 ERR2987797 ERR2987796 ERR2987795 ERR2987794 ERR2987793 SRR20748308 SRR20748312 SRR20748314 SRR20748315 SRR20748319 SRR20748323 SRR20748326 SRR20748335 SRR20748336 SRR20748339 SRR20748344 SRR20748348 SRR20748350 SRR20748351 SRR20748352 SRR20748374 SRR20748382 SRR20748383 SRR20748387 SRR20748391 SRR20748399 SRR20748405 SRR20748407 SRR20748413 SRR20748417 SRR20748418 SRR20748419 SRR20748420 SRR20748422 SRR20748423 SRR20748425 SRR20748426 SRR20748428 SRR20748430 SRR20748432 SRR20748434 SRR20748435 SRR20748436 SRR20748437 SRR20748439 SRR20748440 SRR20748441 SRR20748447 SRR20748449 SRR20748455 SRR20748478 SRR20748479 SRR20748482 SRR20748483 ERR5231927 ERR5231926 ERR5231925 ERR5231924 SRR13744590 SRR13744592 SRR13744593 SRR13744603 SRR13744607 SRR13744609 SRR13744610 SRR13744611 SRR13744612 SRR13744613 SRR13744615 SRR13744618 SRR13744620 SRR13744622 SRR13744623 SRR13744624 SRR13744625 SRR13744626 SRR13744627 SRR13744628 SRR13744629 SRR13744630 SRR13744631 SRR13744634 SRR13744635 SRR13744636 SRR13744637 SRR13744638 SRR13744639 SRR13744640 SRR13744644 SRR13744645 SRR13744646 SRR13744648 SRR13744650 SRR13744651 SRR13744652 SRR13744653 SRR13744654 SRR13744655 SRR13744660 SRR13744666 SRR13744667 SRR13744668 SRR13744670 SRR13744671 SRR13744672 SRR13744674 SRR13744675 SRR13744677 SRR13744678 SRR13744679 SRR13744680 SRR12506675 SRR12506676 SRR12506688 SRR12506704 SRR12506707 SRR12506708 SRR12506709 SRR12506711 SRR12506714 ERR3966525 ERR3966522 SRR11098642 SRR11098644 SRR11098645 SRR11098646 SRR11098647 SRR10850245 SRR10850247 SRR10850249 SRR10850252 ERR3723985 ERR3723984 ERR3282907 ERR3282906 ERR3282905 ERR3282904 ERR3282903 ERR3282902;



	fastq-dump --split-files -v $LIB 

	#pré-processamento, avalia qualidade e realiza limpeza
	~/Programas/fastp  -w 30 -i ${BASEDIR}/${LIB}_1.fastq \
	-I ${BASEDIR}/${LIB}_2.fastq \
	-o ${BASEDIR}/fastq/${LIB}_1.trim.fastq \
	-O ${BASEDIR}/fastq/${LIB}_2.trim.fastq 

	#alinhamento e ordenamento contra o genoma de referencia e remocao de duplicadas
	bwa mem -t 20 \
	${BASEDIR}/ref/l_infantum/GCF_000002875.2_ASM287v2_genomic.fna \
	${BASEDIR}/fastq/${LIB}_1.trim.fastq \
	${BASEDIR}/fastq/${LIB}_2.trim.fastq | \
       ~/Programas/samtools-1.20/samtools fixmate -@ 40 -m -u - - | \
        ~/Programas/samtools-1.20/samtools sort -@ 40 -u - | \
       	~/Programas/samtools-1.20/samtools markdup -@ 40 - ${BASEDIR}/map/${LIB}.bam

	
	
	#cálculo de profundidade
	samtools depth -a ${BASEDIR}/map/${LIB}.bam \
	> ${BASEDIR}/depth/${LIB}.txt

	rm ${BASEDIR}/${LIB}_1.fastq
	
	rm ${BASEDIR}/${LIB}_2.fastq
	
	rm ${BASEDIR}/fastq/${LIB}_1.trim.fastq 
	
	rm ${BASEDIR}/fastq/${LIB}_2.trim.fastq 
	
	rm ${BASEDIR}/map/${LIB}.bam 

	rm fastp*

#	docker run -v ${BASEDIR}:/mnt r_ploidy:latest Rscript /mnt/calculo_somia.R /mnt/depth/${LIB}.txt \
#	>  ${BASEDIR}/somia/${LIB}_somia.txt

echo "finalizado somia ${LIB}"


#	docker run -v ${BASEDIR}:/mnt r_ploidy:latest Rscript /mnt/calculo_janela.R /mnt/depth/${LIB}.txt \
#	>  ${BASEDIR}/janela/${LIB}_janela.txt


echo "finalizado janela ${LIB}"

done

echo "todos os processos foram finalizados"
